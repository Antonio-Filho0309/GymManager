<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Alunos</title>
</head>
<body>
  <h1>Cadastro de Alunos</h1>
  <form id="memberForm">
    <input type="text" name="name" placeholder="Nome" required><br>
    <input type="email" name="email" placeholder="Email" required><br>
    <input type="text" name="phone" placeholder="Telefone"><br>
    <button type="submit">Cadastrar</button>
  </form>

  <h2>Lista de alunos</h2>
<ul id="memberList"></ul> 

<script>
  const form = document.getElementById('memberForm');
  const list = document.getElementById('memberList');
  let editingId = null;

  // ðŸ”¹ FunÃ§Ã£o para carregar todos os alunos
  async function loadMembers() {
    try {
      const res = await fetch('/api/members');
      if (!res.ok) throw new Error('Erro ao carregar alunos');
      const members = await res.json();

      if (members.length === 0) {
        list.innerHTML = '<li>Nenhum aluno cadastrado.</li>';
        return;
      }

      list.innerHTML = members.map(m => `
        <li>
          ${m.name} - ${m.email} - ${m.phone}
          <button onclick="editMember(${m.id}, '${m.name}', '${m.email}', '${m.phone}')">Editar</button>
          <button onclick="deleteMember(${m.id})">Excluir</button>
        </li>
      `).join('');
    } catch (err) {
      console.error('Erro ao carregar membros:', err);
      list.innerHTML = '<li>Erro ao carregar lista de alunos.</li>';
    }
  }


  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form));

    try {
      const url = editingId ? `/api/members/${editingId}` : '/api/members';
      const method = editingId ? 'PUT' : 'POST';

      const res = await fetch(url, {
        method,
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });

      if (!res.ok) throw new Error('Erro ao salvar aluno');

      editingId = null;
      form.reset();
      form.querySelector('button').textContent = 'Cadastrar';
      await loadMembers();
    } catch (err) {
      alert('Erro ao salvar aluno.');
      console.error(err);
    }
  });


  async function deleteMember(id) {
    if (!confirm('Tem certeza que deseja excluir este aluno?')) return;
    try {
      const res = await fetch(`/api/members/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Erro ao excluir aluno');
      await loadMembers();
    } catch (err) {
      console.error(err);
      alert('Erro ao excluir aluno.');
    }
  }

  function editMember(id, name, email, phone) {
    form.name.value = name;
    form.email.value = email;
    form.phone.value = phone;
    editingId = id;
    form.querySelector('button').textContent = 'Salvar alteraÃ§Ãµes';
  }

  document.addEventListener('DOMContentLoaded', loadMembers);
</script>

</body>
</html>
